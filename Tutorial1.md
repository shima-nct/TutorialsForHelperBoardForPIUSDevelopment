# スロットルの出力電圧を測る
本チュートリアルでは、サムスロットルの基本的な仕組みを理解し、その出力電圧を実際に測定する方法を学びます。また、測定したデータの分析と実用上の課題について考察します。

## サムスロットルの仕組み

### ホール素子
ホール素子は磁界の強さに応じて電圧を出力する半導体素子です。磁石との距離や向きによって出力電圧が変化する特性を利用して、位置や角度のセンサーとして広く使用されています。

### スロットルの機構
サムスロットルは、ホール素子と永久磁石を組み合わせた非接触型のポジションセンサーです。スロットルレバーの回転に伴って磁石が動き、その磁界の変化をホール素子が検出することで、スロットル開度を電圧として出力します。

### サムスロットルの使い方

#### 配線
サムスロットルには通常、電源（VCC）、グランド（GND）、信号出力（OUT）の3本の配線があります。正しい配線を行うことで、スロットルの開度に応じた電圧出力が得られます。

#### 電源電圧
サムスロットルの電源電圧は一般的に5Vです。安定した動作のために、適切な電圧レギュレータを使用することが推奨されます。

#### コネクタ
サムスロットルのコネクタは、誤接続を防ぐために形状が工夫されています。配線の極性に注意して、確実に接続することが重要です。

## サムスロットル出力の測定

#### ブレッドボードで回路を作る
測定回路は、電源供給とスロットル出力の測定ができるように構成します。ブレッドボード上で、電源、グランド、信号線を適切に配置して接続します。

#### テスターで測る
デジタルマルチメータを使用して、スロットル出力電圧を測定します。電圧レンジを適切に設定し、GNDを基準として出力電圧を測定します。

#### スロットル開度と電圧変化をグラフにする
スロットル開度を変化させながら出力電圧を記録し、その関係をグラフ化します。これにより、スロットルの特性を視覚的に理解することができます。

#### ヘルパーボードを使ってArduinoで測定
ヘルパーボードとArduinoを使用することで、より詳細なデータ収集が可能になります。アナログ入力ピンを使用して、継続的なデータサンプリングと記録を行うことができます。

## リアルタイムOS、FreeRTOS

FreeRTOSは、RTOSの代表的な例です。RTOSは、マルチタスク処理を可能にし、システムの安定性と効率性を向上させることができます。

[Arduinoのライブラリ / FreeRTOS](
https://docs.arduino.cc/libraries/freertos/)

[FreeRTOS とは](https://docs.aws.amazon.com/ja_jp/freertos/latest/userguide/what-is-freertos.html)

### なぜわざわざArduinoでFreeRTOSを使用するのか？

簡単なArduinoプログラムでは繰り返す処理をloop関数内に記述します。この繰り返し処理はどのタイミングで実行されるのかは決して保証されません。タイムクリティカル性が求められない用途であれば、時間間隔を気にするよりも簡単に表現できる方がメリットがあります。

しかし、ロボットなど外界に影響を与えるシステムでは、運動などの場合では物理法則に則るように制御する必要があり、そのため時間間隔を保つことが重要となります。そのため、時間間隔を保証することができるRTOSを使用することがこのような対応が容易になります。

## 課題

#### 課題1 

スロットルを開いていなくても若干の出力電圧が現れています。この出力をそのままPIUSのスロットルとして用いることはできるでしょうか？問題があるとすれば、それはどのような問題なのかとその問題の解決方法を示し、プログラムとして実装しなさい。

#### 課題2

##### 2.1

スロットルの開度を一定とした場合でも出力電圧はある程度のブレが生じています。このブレのヒストグラムを求めなさい。

#### 2.2

この出力をそのままPIUSのスロットルとして用いることはできるでしょうか？問題があるとすれば、それはどのような問題なのかと、その問題の解決方法をし、プログラムとして実装しなさい。

#### 2.3

ヘルパーモジュールで用いているM5Stamp C3UのMCU、ESP32C3が備えているADCのサンプリング周波数のレンジ（最低周波数と最高周波数）を探し、答えなさい。（ヒント：sample_freq_hz）

### 課題3

#### 3.1

速度30km/hで進む車両が20msの間に進む距離を求めなさい。また20ms遅延について許容の是非を定めなさい。許容すべきでないとした場合、許容する遅延時間を定めなさい。

#### 3.2

制御系の実装にリアルタイムOS（RTOS）が必要な理由を答えなさい。またFreeRTOSについてしらべ、その特徴を答えなさい。
